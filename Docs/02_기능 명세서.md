# Functional Specification: Aegis-AI : DAS

## 1. Tab 1: Aegis Digital Twin (Visualization)

이 탭은 시스템의 최종 출력을 시각화합니다. 고정된 배경 이미지 위에 상태에 따라 변하는 레이어들을 쌓는 **'Layered View'** 구조를 채택합니다.

### 1.1 레이어 구조 (Z-Index 순서)

1. **Base Layer:** 차량의 고해상도 화이트 톤 탑뷰/내부 이미지 (고정).
2. **Status Layer:** `Context Tools` 상태 시각화 (예: 차선 이탈 위험 시 차선 가이드라인 투명도 조절).
3. **Action Layer:** `Action Tools` 실행 애니메이션 (예: 핸들 진동, 비상등 점멸, 팝업 경고).
4. **Interaction Layer:** 뷰 전환 버튼 (Top-view <-> Interior-view).

### 1.2 핵심 애니메이션 로직

* **State-Driven:** 모든 애니메이션은 ViewModel의 `toolState` 값이 변경될 때 즉시 트리거됩니다.
* **Action Mapping 예시:**
* `trigger_steering_vibration == true`: 핸들 이미지에 `Repeatable` 오프셋 애니메이션 적용.
* `update_ambient_mood_lighting`: 화면 하단에 가우시안 블러가 적용된 컬러 오버레이 `animateColorAsState` 적용.



---

## 2. Tab 2: Neural Grid (Data Manager)

전체 시스템의 '신경망'인 50개 도구의 실시간 수치를 관리하고 조작하는 관제 패널입니다.

### 2.1 UI 구성

* **Grid Layout:** 2열 또는 3열 카드 그리드.
* **Card Design:** Glassmorphism 스타일. 제목, 아이콘, 현재 Value, 단위(Unit) 포함.
* **Category Toggle:** 'Context Tools (Blue)'와 'Action Tools (Amber)'를 필터링하는 상단 칩(Chip).

### 2.2 디버그 편집 모드 (Debug Edit Mode)

* **작동:** Tab 4의 'Debug Mode'가 활성화된 경우에만 작동.
* **Value Edit:** 카드 클릭 시 **Bottom Sheet**가 올라오며, 해당 도구의 타입에 맞는 입력 컨트롤 제공.
* *Boolean:* 스위치(Switch)
* *Int/Float:* 슬라이더(Slider) 또는 증감 버튼
* *Enum/String:* 드롭다운 메뉴



---

## 3. Tab 3: Thinking Log (Reasoning Stream)

FunctionGemma의 사고 과정과 실제 데이터 입출력을 기록합니다. 개발자와 사용자에게 AI의 판단 근거를 제공합니다.

### 3.1Thought Bubble (추론 로그)

* **위치:** 화면 상단 고정 영역.
* **내용:** JSON 데이터 중 `thought` 필드만 추출하여 자연어로 표시.
* **효과:** 새로운 추론이 올 때마다 이전 텍스트가 위로 밀려나며 **타이핑 효과(Typewriter)**와 함께 등장.

### 3.2 System Log (Raw Data)

* **구조:** 타임스탬프와 함께 데이터 종류(Input/Output/System)를 구분하여 리스트업.
* **JSON 시각화:** JSON 데이터는 문법 하이라이팅(Syntax Highlighting)을 적용하여 가독성 확보.
* **Debug Mode 전용:** 앱 내부의 시스템 로그(메모리, 추론 속도 등)는 디버그 모드 True일 때만 표시.

---

## 4. Tab 4: System Control (Configurator)

시뮬레이션의 환경을 설정하고 특정 상황을 강제로 주입합니다.

### 4.1 하드웨어 및 모드 설정

* **Processor Selector:** Radio Button 그룹 (CPU, GPU, NPU/Exynos). *실제 가속기 연동 여부와 관계없이 UI 선택 상태 유지.*
* **Global Debug Switch:** 앱 전체의 편집 권한 및 상세 로그 활성화 여부 결정.

### 4.2 Scenario Injector (시나리오 실행기)

* **UI:** 가로 스크롤 또는 그리드 형태의 대형 버튼.
* **작동 로직:** 버튼 클릭 시 미리 정의된 **'Context Tool Value Set'**을 ViewModel에 주입.
* **실행 순서:** 1.  Context 값 일괄 업데이트.
2.  업데이트된 값을 기반으로 FunctionGemma에게 `Generate` 요청 전송.
3.  결과로 오는 `Action Tool` 호출을 즉시 실행.

---

> **Note for AI:** > 모든 데이터 업데이트는 `StateFlow`를 통해 비동기적으로 처리되어야 하며, UI 스레드 차단을 방지하기 위해 `Dispatchers.Main`에서 애니메이션을 처리하고 데이터 가공은 `Dispatchers.Default`에서 수행하세요.